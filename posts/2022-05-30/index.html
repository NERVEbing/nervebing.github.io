<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>使用 Rust 构建 gRPC 微服务 | Lv's Playground</title>
<meta name=keywords content="gRPC,Rust,Microservices"><meta name=description content="前言
当前越来越多的公司基于 Google gRPC 通信框架来构建微服务体系，比较流行的是使用 Go/Java/C++
这样的主流编程语言来编写服务端，我们今天来尝试使用 Rust 语言来实现一个 gRPC 服务端/客户端。
打开官方文档可以看到目前 Rust 并不在 gRPC 官方支持的语言列表中：

Supported languages

C#
C++
Dart
Go
Java
Kotlin
Node
Objective-C
PHP
Python
Ruby


不过不用担心这个问题。我们知道只要某个语言兼容了基于 C/C++ 编写的 gRPC 的核心库
，那么该语言就可以完美支持 gRPC。目前 Rust 可以实现 gRPC 的主流 crate 如下：

tonic
grpc-rs
grpc-rust

以上三种任选其一都可以，只是 grpc-rs/grpc-rust 当前还处于开发状态，我们在这里使用 tonic 包。
构建程序
首先检查你的 Rust 版本：
$ rustc --version
rustc 1.61.0 (fe5b13d68 2022-05-18)
tonic 适用于 1.56 及以上，如果低于这个版本，你应该先更新你的 Rust 编译器：
$ rustup update stable
确保你已经提前安装了 protobuf："><meta name=author content="L"><link rel=canonical href=https://lvlv.fun/posts/2022-05-30/><link crossorigin=anonymous href=/assets/css/stylesheet.css rel="preload stylesheet" as=style><link rel=icon href=https://lvlv.fun/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://lvlv.fun/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://lvlv.fun/favicon-32x32.png><link rel=apple-touch-icon href=https://lvlv.fun/apple-touch-icon.png><link rel=mask-icon href=https://lvlv.fun/apple-touch-icon.png><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=en href=https://lvlv.fun/posts/2022-05-30/><noscript><style>#theme-toggle,.top-link{display:none}</style></noscript><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/lxgw-wenkai-screen-webfont@1.7.0/style.min.css><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/@fontsource/mononoki@5.0.7/index.min.css><script defer src=https://hi.lvlv.fun/hi.js data-website-id=685c7d96-4af8-4152-8071-ff743ac81947 data-domains=lvlv.fun></script><script>const isLightMode=function(){return localStorage.getItem("pref-theme")!=="dark"},getModeSwitch=function(){return document.getElementById("theme-toggle")}</script><meta property="og:url" content="https://lvlv.fun/posts/2022-05-30/"><meta property="og:site_name" content="Lv's Playground"><meta property="og:title" content="使用 Rust 构建 gRPC 微服务"><meta property="og:description" content="前言 当前越来越多的公司基于 Google gRPC 通信框架来构建微服务体系，比较流行的是使用 Go/Java/C++ 这样的主流编程语言来编写服务端，我们今天来尝试使用 Rust 语言来实现一个 gRPC 服务端/客户端。
打开官方文档可以看到目前 Rust 并不在 gRPC 官方支持的语言列表中：
Supported languages
C# C++ Dart Go Java Kotlin Node Objective-C PHP Python Ruby 不过不用担心这个问题。我们知道只要某个语言兼容了基于 C/C++ 编写的 gRPC 的核心库 ，那么该语言就可以完美支持 gRPC。目前 Rust 可以实现 gRPC 的主流 crate 如下：
tonic grpc-rs grpc-rust 以上三种任选其一都可以，只是 grpc-rs/grpc-rust 当前还处于开发状态，我们在这里使用 tonic 包。
构建程序 首先检查你的 Rust 版本：
$ rustc --version rustc 1.61.0 (fe5b13d68 2022-05-18) tonic 适用于 1.56 及以上，如果低于这个版本，你应该先更新你的 Rust 编译器：
$ rustup update stable 确保你已经提前安装了 protobuf："><meta property="og:locale" content="en"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2022-05-30T02:25:11+08:00"><meta property="article:modified_time" content="2022-05-30T02:25:11+08:00"><meta property="article:tag" content="GRPC"><meta property="article:tag" content="Rust"><meta property="article:tag" content="Microservices"><meta name=twitter:card content="summary"><meta name=twitter:title content="使用 Rust 构建 gRPC 微服务"><meta name=twitter:description content="前言
当前越来越多的公司基于 Google gRPC 通信框架来构建微服务体系，比较流行的是使用 Go/Java/C++
这样的主流编程语言来编写服务端，我们今天来尝试使用 Rust 语言来实现一个 gRPC 服务端/客户端。
打开官方文档可以看到目前 Rust 并不在 gRPC 官方支持的语言列表中：

Supported languages

C#
C++
Dart
Go
Java
Kotlin
Node
Objective-C
PHP
Python
Ruby


不过不用担心这个问题。我们知道只要某个语言兼容了基于 C/C++ 编写的 gRPC 的核心库
，那么该语言就可以完美支持 gRPC。目前 Rust 可以实现 gRPC 的主流 crate 如下：

tonic
grpc-rs
grpc-rust

以上三种任选其一都可以，只是 grpc-rs/grpc-rust 当前还处于开发状态，我们在这里使用 tonic 包。
构建程序
首先检查你的 Rust 版本：
$ rustc --version
rustc 1.61.0 (fe5b13d68 2022-05-18)
tonic 适用于 1.56 及以上，如果低于这个版本，你应该先更新你的 Rust 编译器：
$ rustup update stable
确保你已经提前安装了 protobuf："><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://lvlv.fun/posts/"},{"@type":"ListItem","position":2,"name":"使用 Rust 构建 gRPC 微服务","item":"https://lvlv.fun/posts/2022-05-30/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"使用 Rust 构建 gRPC 微服务","name":"使用 Rust 构建 gRPC 微服务","description":"前言 当前越来越多的公司基于 Google gRPC 通信框架来构建微服务体系，比较流行的是使用 Go/Java/C++ 这样的主流编程语言来编写服务端，我们今天来尝试使用 Rust 语言来实现一个 gRPC 服务端/客户端。\n打开官方文档可以看到目前 Rust 并不在 gRPC 官方支持的语言列表中：\nSupported languages\nC# C++ Dart Go Java Kotlin Node Objective-C PHP Python Ruby 不过不用担心这个问题。我们知道只要某个语言兼容了基于 C/C++ 编写的 gRPC 的核心库 ，那么该语言就可以完美支持 gRPC。目前 Rust 可以实现 gRPC 的主流 crate 如下：\ntonic grpc-rs grpc-rust 以上三种任选其一都可以，只是 grpc-rs/grpc-rust 当前还处于开发状态，我们在这里使用 tonic 包。\n构建程序 首先检查你的 Rust 版本：\n$ rustc --version rustc 1.61.0 (fe5b13d68 2022-05-18) tonic 适用于 1.56 及以上，如果低于这个版本，你应该先更新你的 Rust 编译器：\n$ rustup update stable 确保你已经提前安装了 protobuf：\n","keywords":["gRPC","Rust","Microservices"],"articleBody":"前言 当前越来越多的公司基于 Google gRPC 通信框架来构建微服务体系，比较流行的是使用 Go/Java/C++ 这样的主流编程语言来编写服务端，我们今天来尝试使用 Rust 语言来实现一个 gRPC 服务端/客户端。\n打开官方文档可以看到目前 Rust 并不在 gRPC 官方支持的语言列表中：\nSupported languages\nC# C++ Dart Go Java Kotlin Node Objective-C PHP Python Ruby 不过不用担心这个问题。我们知道只要某个语言兼容了基于 C/C++ 编写的 gRPC 的核心库 ，那么该语言就可以完美支持 gRPC。目前 Rust 可以实现 gRPC 的主流 crate 如下：\ntonic grpc-rs grpc-rust 以上三种任选其一都可以，只是 grpc-rs/grpc-rust 当前还处于开发状态，我们在这里使用 tonic 包。\n构建程序 首先检查你的 Rust 版本：\n$ rustc --version rustc 1.61.0 (fe5b13d68 2022-05-18) tonic 适用于 1.56 及以上，如果低于这个版本，你应该先更新你的 Rust 编译器：\n$ rustup update stable 确保你已经提前安装了 protobuf：\n$ protoc --version libprotoc 3.19.4 # macOS 可以通过以下命令安装 $ brew install protobuf 使用 cargo 新建一个项目\n$ cargo new grpcrs $ cd grpcrs $ cargo run Compiling grpcrs v0.1.0 (/Users/lvlv/Documents/project/demo/grpcrs) Finished dev [unoptimized + debuginfo] target(s) in 0.55s Running `target/debug/grpcrs` Hello, world! 编辑 cargo.toml 文件：\n[package] name = \"grpcrs\" version = \"0.1.0\" edition = \"2021\" [[bin]] name = \"user-server\" path = \"src/user/server.rs\" [[bin]] name = \"user-client\" path = \"src/user/client.rs\" [dependencies] tonic = \"0.7.2\" tokio = { version = \"1.18.2\", features = [\"macros\", \"rt-multi-thread\"] } prost = \"0.10\" [build-dependencies] tonic-build = \"0.7.2\" 创建下列文件：\n$ mkdir -p proto/user src/user $ touch build.rs proto/user/user.proto src/user/{server.rs,client.rs} 当前目录结构：\n$ tree -L 3 . ├── Cargo.lock ├── Cargo.toml ├── build.rs # Cargo 构建脚本 ├── proto │ └── user │ └── user.proto # proto 文件 └── src └── user ├── client.rs # gRPC 客户端代码 └── server.rs # gRPC 服务端代码 分别将以下内容拷贝到各个文件：\nproto/user/user.proto syntax = \"proto3\"; package user; service User { rpc Hello (HelloRequest) returns (HelloReply) {} } message HelloRequest { string name = 1; } message HelloReply { string message = 1; } src/user/server.rs use tonic::{transport::Server, Request, Response, Status}; use user::user_server::{User, UserServer}; use user::{HelloReply, HelloRequest}; pub mod user { tonic::include_proto!(\"user\"); } #[derive(Default)] pub struct UserService {} #[tonic::async_trait] impl User for UserService { async fn hello(\u0026self, request: Request\u003cHelloRequest\u003e) -\u003e Result\u003cResponse\u003cHelloReply\u003e, Status\u003e { println!(\"New user request from {:?}\", request.remote_addr()); let reply = user::HelloReply { message: format!(\"Hello {}!\", request.into_inner().name), }; Ok(Response::new(reply)) } } #[tokio::main] async fn main() -\u003e Result\u003c(), Box\u003cdyn std::error::Error\u003e\u003e { let addr = \"127.0.0.1:50051\".parse().unwrap(); let user_service = UserService::default(); println!(\"UserService listening on {}\", addr); Server::builder() .add_service(UserServer::new(user_service)) .serve(addr) .await?; Ok(()) } src/user/client.rs use user::user_client::UserClient; use user::HelloRequest; pub mod user { tonic::include_proto!(\"user\"); } #[tokio::main] async fn main() -\u003e Result\u003c(), Box\u003cdyn std::error::Error\u003e\u003e { let mut client = UserClient::connect(\"http://127.0.0.1:50051\").await?; let request = tonic::Request::new(HelloRequest { name: \"Rick\".into(), }); let response = client.hello(request).await?; println!(\"RESPONSE={:?}\", response); Ok(()) } build.rs use std::{env, path::PathBuf}; fn main() { let out_dir = PathBuf::from(env::var(\"OUT_DIR\").unwrap()); let user_proto = \"proto/user/user.proto\"; tonic_build::configure() .build_server(true) .build_client(true) .out_dir(\u0026out_dir) .file_descriptor_set_path(\u0026out_dir.join(\"user_descriptor.bin\")) .compile(\u0026[user_proto], \u0026[\"proto\"]) .unwrap_or_else(|err| panic!(\"protobuf compile failed: {}\", err)); } 尝试编译代码：\n$ cargo build Compiling proc-macro2 v1.0.39 Compiling unicode-ident v1.0.0 Compiling syn v1.0.95 Compiling libc v0.2.126 Compiling cfg-if v1.0.0 Compiling log v0.4.17 # ... 省略 Compiling hyper v0.14.19 Compiling axum v0.5.6 Compiling hyper-timeout v0.4.1 Compiling tonic v0.7.2 Finished dev [unoptimized + debuginfo] target(s) in 21.01s 如果编译通过，现在我们可以尝试执行编译好的程序了。\n首先启动 gRPC 服务端程序：\n$ cargo run --bin user-server Finished dev [unoptimized + debuginfo] target(s) in 0.04s Running `target/debug/user-server` UserService listening on 127.0.0.1:50051 重新打开一个 terminal 窗口并执行客户端程序：\n$ cargo run --bin user-client Finished dev [unoptimized + debuginfo] target(s) in 0.05s Running `target/debug/user-client` RESPONSE=Response { metadata: MetadataMap { headers: {\"content-type\": \"application/grpc\", \"date\": \"Sun, 29 May 2022 21:54:18 GMT\", \"grpc-status\": \"0\"} }, message: HelloReply { message: \"Hello Rick!\" }, extensions: Extensions } # \u003c- 客户端请求成功并返回响应 此时我们切回服务端 terminal 窗口查看日志：\n# ... UserService listening on 127.0.0.1:50051 New user request from Some(127.0.0.1:52147) # \u003c- 客户端调用成功 至此，一个简单的基于 Rust 的 gRPC 服务端/客户端就实现了。上述代码很简陋，相信只要是接触过 gRPC 的同学都比较容易就可以理解。\n","wordCount":"543","inLanguage":"en","datePublished":"2022-05-30T02:25:11+08:00","dateModified":"2022-05-30T02:25:11+08:00","author":{"@type":"Person","name":"L"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://lvlv.fun/posts/2022-05-30/"},"publisher":{"@type":"Organization","name":"Lv's Playground","logo":{"@type":"ImageObject","url":"https://lvlv.fun/favicon.ico"}}}</script></head><body class=dark id=top><header class=header><nav class=nav><div class=logo><a href=https://lvlv.fun/ accesskey=h title="Started (Alt + H)"><img src=https://lvlv.fun/apple-touch-icon.png alt aria-label=logo height=35>Started</a><div class=logo-switches></div></div><ul id=menu><li><a href=https://lvlv.fun/latest/ title=Latest><span>Latest</span></a></li><li><a href=https://lvlv.fun/navigation/ title=Navigation><span>Navigation</span></a></li><li><a href=https://lvlv.fun/archives/ title=Archives><span>Archives</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://lvlv.fun/>Home</a>&nbsp;»&nbsp;<a href=https://lvlv.fun/posts/>Posts</a></div><h1 class="post-title entry-hint-parent">使用 Rust 构建 gRPC 微服务</h1><div class=post-meta><span title='2022-05-30 02:25:11 +0800 +0800'>2022-05-30</span>&nbsp;·&nbsp;3 min&nbsp;·&nbsp;L&nbsp;|&nbsp;<a href=https://github.com/NERVEbing/blog/blob/master/content/posts/2022-05-30.md rel="noopener noreferrer" target=_blank>Suggest Changes</a></div></header><div class=toc><details><summary accesskey=c title="(Alt + C)"><span class=details>Table of Contents</span></summary><div class=inner><ul><li><a href=#%e5%89%8d%e8%a8%80 aria-label=前言>前言</a></li><li><a href=#%e6%9e%84%e5%bb%ba%e7%a8%8b%e5%ba%8f aria-label=构建程序>构建程序</a></li></ul></div></details></div><div class=post-content><h3 id=前言>前言<a hidden class=anchor aria-hidden=true href=#前言>#</a></h3><p>当前越来越多的公司基于 Google <a href=https://grpc.io>gRPC</a> 通信框架来构建微服务体系，比较流行的是使用 Go/Java/C++
这样的主流编程语言来编写服务端，我们今天来尝试使用 Rust 语言来实现一个 gRPC 服务端/客户端。</p><p>打开<a href=https://grpc.io/docs/languages/>官方文档</a>可以看到目前 Rust 并不在 gRPC 官方支持的语言列表中：</p><blockquote><p>Supported languages</p><ul><li>C#</li><li>C++</li><li>Dart</li><li>Go</li><li>Java</li><li>Kotlin</li><li>Node</li><li>Objective-C</li><li>PHP</li><li>Python</li><li>Ruby</li></ul></blockquote><p>不过不用担心这个问题。我们知道只要某个语言兼容了基于 C/C++ 编写的 gRPC 的<a href=https://github.com/grpc/grpc>核心库</a>
，那么该语言就可以完美支持 gRPC。目前 Rust 可以实现 gRPC 的主流 crate 如下：</p><ul><li><a href=https://github.com/hyperium/tonic>tonic</a></li><li><a href=https://github.com/tikv/grpc-rs>grpc-rs</a></li><li><a href=https://github.com/stepancheg/grpc-rust>grpc-rust</a></li></ul><p>以上三种任选其一都可以，只是 grpc-rs/grpc-rust 当前还处于开发状态，我们在这里使用 tonic 包。</p><h3 id=构建程序>构建程序<a hidden class=anchor aria-hidden=true href=#构建程序>#</a></h3><p>首先检查你的 Rust 版本：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>$ rustc --version
</span></span><span class=line><span class=cl>rustc 1.61.0 <span class=o>(</span>fe5b13d68 2022-05-18<span class=o>)</span>
</span></span></code></pre></div><p>tonic 适用于 1.56 及以上，如果低于这个版本，你应该先更新你的 Rust 编译器：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>$ rustup update stable
</span></span></code></pre></div><p>确保你已经提前安装了 protobuf：</p><pre tabindex=0><code>$ protoc --version
libprotoc 3.19.4

# macOS 可以通过以下命令安装
$ brew install protobuf
</code></pre><p>使用 cargo 新建一个项目</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>$ cargo new grpcrs
</span></span><span class=line><span class=cl>$ <span class=nb>cd</span> grpcrs
</span></span><span class=line><span class=cl>$ cargo run
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>   Compiling grpcrs v0.1.0 <span class=o>(</span>/Users/lvlv/Documents/project/demo/grpcrs<span class=o>)</span>
</span></span><span class=line><span class=cl>    Finished dev <span class=o>[</span>unoptimized + debuginfo<span class=o>]</span> target<span class=o>(</span>s<span class=o>)</span> in 0.55s
</span></span><span class=line><span class=cl>     Running <span class=sb>`</span>target/debug/grpcrs<span class=sb>`</span>
</span></span><span class=line><span class=cl>Hello, world!
</span></span></code></pre></div><p>编辑 cargo.toml 文件：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-toml data-lang=toml><span class=line><span class=cl><span class=p>[</span><span class=nx>package</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=nx>name</span> <span class=p>=</span> <span class=s2>&#34;grpcrs&#34;</span>
</span></span><span class=line><span class=cl><span class=nx>version</span> <span class=p>=</span> <span class=s2>&#34;0.1.0&#34;</span>
</span></span><span class=line><span class=cl><span class=nx>edition</span> <span class=p>=</span> <span class=s2>&#34;2021&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>[[</span><span class=nx>bin</span><span class=p>]]</span>
</span></span><span class=line><span class=cl><span class=nx>name</span> <span class=p>=</span> <span class=s2>&#34;user-server&#34;</span>
</span></span><span class=line><span class=cl><span class=nx>path</span> <span class=p>=</span> <span class=s2>&#34;src/user/server.rs&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>[[</span><span class=nx>bin</span><span class=p>]]</span>
</span></span><span class=line><span class=cl><span class=nx>name</span> <span class=p>=</span> <span class=s2>&#34;user-client&#34;</span>
</span></span><span class=line><span class=cl><span class=nx>path</span> <span class=p>=</span> <span class=s2>&#34;src/user/client.rs&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>[</span><span class=nx>dependencies</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=nx>tonic</span> <span class=p>=</span> <span class=s2>&#34;0.7.2&#34;</span>
</span></span><span class=line><span class=cl><span class=nx>tokio</span> <span class=p>=</span> <span class=p>{</span> <span class=nx>version</span> <span class=p>=</span> <span class=s2>&#34;1.18.2&#34;</span><span class=p>,</span> <span class=nx>features</span> <span class=p>=</span> <span class=p>[</span><span class=s2>&#34;macros&#34;</span><span class=p>,</span> <span class=s2>&#34;rt-multi-thread&#34;</span><span class=p>]</span> <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=nx>prost</span> <span class=p>=</span> <span class=s2>&#34;0.10&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>[</span><span class=nx>build-dependencies</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=nx>tonic-build</span> <span class=p>=</span> <span class=s2>&#34;0.7.2&#34;</span>
</span></span></code></pre></div><p>创建下列文件：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>$ mkdir -p proto/user src/user
</span></span><span class=line><span class=cl>$ touch build.rs proto/user/user.proto src/user/<span class=o>{</span>server.rs,client.rs<span class=o>}</span>
</span></span></code></pre></div><p>当前目录结构：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>$ tree -L <span class=m>3</span>
</span></span><span class=line><span class=cl>.
</span></span><span class=line><span class=cl>├── Cargo.lock
</span></span><span class=line><span class=cl>├── Cargo.toml
</span></span><span class=line><span class=cl>├── build.rs <span class=c1># Cargo 构建脚本</span>
</span></span><span class=line><span class=cl>├── proto
</span></span><span class=line><span class=cl>│   └── user
</span></span><span class=line><span class=cl>│       └── user.proto <span class=c1># proto 文件</span>
</span></span><span class=line><span class=cl>└── src
</span></span><span class=line><span class=cl>    └── user
</span></span><span class=line><span class=cl>        ├── client.rs <span class=c1># gRPC 客户端代码</span>
</span></span><span class=line><span class=cl>        └── server.rs <span class=c1># gRPC 服务端代码</span>
</span></span></code></pre></div><p>分别将以下内容拷贝到各个文件：</p><ul><li>proto/user/user.proto</li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-proto data-lang=proto><span class=line><span class=cl><span class=n>syntax</span> <span class=o>=</span> <span class=s>&#34;proto3&#34;</span><span class=p>;</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=kn>package</span> <span class=nn>user</span><span class=p>;</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=kd>service</span> <span class=n>User</span> <span class=p>{</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span>  <span class=k>rpc</span> <span class=n>Hello</span> <span class=p>(</span><span class=n>HelloRequest</span><span class=p>)</span> <span class=k>returns</span> <span class=p>(</span><span class=n>HelloReply</span><span class=p>)</span> <span class=p>{}</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=p>}</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=kd>message</span> <span class=nc>HelloRequest</span> <span class=p>{</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span>  <span class=kt>string</span> <span class=n>name</span> <span class=o>=</span> <span class=mi>1</span><span class=p>;</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=p>}</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=kd>message</span> <span class=nc>HelloReply</span> <span class=p>{</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span>  <span class=kt>string</span> <span class=kd>message</span> <span class=o>=</span> <span class=mi>1</span><span class=p>;</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=p>}</span><span class=err>
</span></span></span></code></pre></div><ul><li>src/user/server.rs</li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-rust data-lang=rust><span class=line><span class=cl><span class=k>use</span><span class=w> </span><span class=n>tonic</span>::<span class=p>{</span><span class=n>transport</span>::<span class=n>Server</span><span class=p>,</span><span class=w> </span><span class=n>Request</span><span class=p>,</span><span class=w> </span><span class=n>Response</span><span class=p>,</span><span class=w> </span><span class=n>Status</span><span class=p>};</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>use</span><span class=w> </span><span class=n>user</span>::<span class=n>user_server</span>::<span class=p>{</span><span class=n>User</span><span class=p>,</span><span class=w> </span><span class=n>UserServer</span><span class=p>};</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>use</span><span class=w> </span><span class=n>user</span>::<span class=p>{</span><span class=n>HelloReply</span><span class=p>,</span><span class=w> </span><span class=n>HelloRequest</span><span class=p>};</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>pub</span><span class=w> </span><span class=k>mod</span> <span class=nn>user</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>tonic</span>::<span class=fm>include_proto!</span><span class=p>(</span><span class=s>&#34;user&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=cp>#[derive(Default)]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>pub</span><span class=w> </span><span class=k>struct</span> <span class=nc>UserService</span><span class=w> </span><span class=p>{}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=cp>#[tonic::async_trait]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>impl</span><span class=w> </span><span class=n>User</span><span class=w> </span><span class=k>for</span><span class=w> </span><span class=n>UserService</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>async</span><span class=w> </span><span class=k>fn</span> <span class=nf>hello</span><span class=p>(</span><span class=o>&amp;</span><span class=bp>self</span><span class=p>,</span><span class=w> </span><span class=n>request</span>: <span class=nc>Request</span><span class=o>&lt;</span><span class=n>HelloRequest</span><span class=o>&gt;</span><span class=p>)</span><span class=w> </span>-&gt; <span class=nb>Result</span><span class=o>&lt;</span><span class=n>Response</span><span class=o>&lt;</span><span class=n>HelloReply</span><span class=o>&gt;</span><span class=p>,</span><span class=w> </span><span class=n>Status</span><span class=o>&gt;</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=fm>println!</span><span class=p>(</span><span class=s>&#34;New user request from </span><span class=si>{:?}</span><span class=s>&#34;</span><span class=p>,</span><span class=w> </span><span class=n>request</span><span class=p>.</span><span class=n>remote_addr</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=kd>let</span><span class=w> </span><span class=n>reply</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>user</span>::<span class=n>HelloReply</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>message</span>: <span class=nc>format</span><span class=o>!</span><span class=p>(</span><span class=s>&#34;Hello {}!&#34;</span><span class=p>,</span><span class=w> </span><span class=n>request</span><span class=p>.</span><span class=n>into_inner</span><span class=p>().</span><span class=n>name</span><span class=p>),</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>};</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nb>Ok</span><span class=p>(</span><span class=n>Response</span>::<span class=n>new</span><span class=p>(</span><span class=n>reply</span><span class=p>))</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=cp>#[tokio::main]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>async</span><span class=w> </span><span class=k>fn</span> <span class=nf>main</span><span class=p>()</span><span class=w> </span>-&gt; <span class=nb>Result</span><span class=o>&lt;</span><span class=p>(),</span><span class=w> </span><span class=nb>Box</span><span class=o>&lt;</span><span class=k>dyn</span><span class=w> </span><span class=n>std</span>::<span class=n>error</span>::<span class=n>Error</span><span class=o>&gt;&gt;</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>let</span><span class=w> </span><span class=n>addr</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s>&#34;127.0.0.1:50051&#34;</span><span class=p>.</span><span class=n>parse</span><span class=p>().</span><span class=n>unwrap</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>let</span><span class=w> </span><span class=n>user_service</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>UserService</span>::<span class=n>default</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=fm>println!</span><span class=p>(</span><span class=s>&#34;UserService listening on </span><span class=si>{}</span><span class=s>&#34;</span><span class=p>,</span><span class=w> </span><span class=n>addr</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>Server</span>::<span class=n>builder</span><span class=p>()</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>.</span><span class=n>add_service</span><span class=p>(</span><span class=n>UserServer</span>::<span class=n>new</span><span class=p>(</span><span class=n>user_service</span><span class=p>))</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>.</span><span class=n>serve</span><span class=p>(</span><span class=n>addr</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>.</span><span class=k>await</span><span class=o>?</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nb>Ok</span><span class=p>(())</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></div><ul><li>src/user/client.rs</li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-rust data-lang=rust><span class=line><span class=cl><span class=k>use</span><span class=w> </span><span class=n>user</span>::<span class=n>user_client</span>::<span class=n>UserClient</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>use</span><span class=w> </span><span class=n>user</span>::<span class=n>HelloRequest</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>pub</span><span class=w> </span><span class=k>mod</span> <span class=nn>user</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>tonic</span>::<span class=fm>include_proto!</span><span class=p>(</span><span class=s>&#34;user&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=cp>#[tokio::main]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>async</span><span class=w> </span><span class=k>fn</span> <span class=nf>main</span><span class=p>()</span><span class=w> </span>-&gt; <span class=nb>Result</span><span class=o>&lt;</span><span class=p>(),</span><span class=w> </span><span class=nb>Box</span><span class=o>&lt;</span><span class=k>dyn</span><span class=w> </span><span class=n>std</span>::<span class=n>error</span>::<span class=n>Error</span><span class=o>&gt;&gt;</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>let</span><span class=w> </span><span class=k>mut</span><span class=w> </span><span class=n>client</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>UserClient</span>::<span class=n>connect</span><span class=p>(</span><span class=s>&#34;http://127.0.0.1:50051&#34;</span><span class=p>).</span><span class=k>await</span><span class=o>?</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>let</span><span class=w> </span><span class=n>request</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>tonic</span>::<span class=n>Request</span>::<span class=n>new</span><span class=p>(</span><span class=n>HelloRequest</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>name</span>: <span class=s>&#34;Rick&#34;</span><span class=p>.</span><span class=n>into</span><span class=p>(),</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>});</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>let</span><span class=w> </span><span class=n>response</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>client</span><span class=p>.</span><span class=n>hello</span><span class=p>(</span><span class=n>request</span><span class=p>).</span><span class=k>await</span><span class=o>?</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=fm>println!</span><span class=p>(</span><span class=s>&#34;RESPONSE=</span><span class=si>{:?}</span><span class=s>&#34;</span><span class=p>,</span><span class=w> </span><span class=n>response</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nb>Ok</span><span class=p>(())</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></div><ul><li>build.rs</li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-rust data-lang=rust><span class=line><span class=cl><span class=k>use</span><span class=w> </span><span class=n>std</span>::<span class=p>{</span><span class=n>env</span><span class=p>,</span><span class=w> </span><span class=n>path</span>::<span class=n>PathBuf</span><span class=p>};</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>fn</span> <span class=nf>main</span><span class=p>()</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>let</span><span class=w> </span><span class=n>out_dir</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>PathBuf</span>::<span class=n>from</span><span class=p>(</span><span class=n>env</span>::<span class=n>var</span><span class=p>(</span><span class=s>&#34;OUT_DIR&#34;</span><span class=p>).</span><span class=n>unwrap</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>let</span><span class=w> </span><span class=n>user_proto</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s>&#34;proto/user/user.proto&#34;</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>tonic_build</span>::<span class=n>configure</span><span class=p>()</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>.</span><span class=n>build_server</span><span class=p>(</span><span class=kc>true</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>.</span><span class=n>build_client</span><span class=p>(</span><span class=kc>true</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>.</span><span class=n>out_dir</span><span class=p>(</span><span class=o>&amp;</span><span class=n>out_dir</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>.</span><span class=n>file_descriptor_set_path</span><span class=p>(</span><span class=o>&amp;</span><span class=n>out_dir</span><span class=p>.</span><span class=n>join</span><span class=p>(</span><span class=s>&#34;user_descriptor.bin&#34;</span><span class=p>))</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>.</span><span class=n>compile</span><span class=p>(</span><span class=o>&amp;</span><span class=p>[</span><span class=n>user_proto</span><span class=p>],</span><span class=w> </span><span class=o>&amp;</span><span class=p>[</span><span class=s>&#34;proto&#34;</span><span class=p>])</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>.</span><span class=n>unwrap_or_else</span><span class=p>(</span><span class=o>|</span><span class=n>err</span><span class=o>|</span><span class=w> </span><span class=fm>panic!</span><span class=p>(</span><span class=s>&#34;protobuf compile failed: </span><span class=si>{}</span><span class=s>&#34;</span><span class=p>,</span><span class=w> </span><span class=n>err</span><span class=p>));</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></div><p>尝试编译代码：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>$ cargo build                
</span></span><span class=line><span class=cl>   Compiling proc-macro2 v1.0.39
</span></span><span class=line><span class=cl>   Compiling unicode-ident v1.0.0
</span></span><span class=line><span class=cl>   Compiling syn v1.0.95
</span></span><span class=line><span class=cl>   Compiling libc v0.2.126
</span></span><span class=line><span class=cl>   Compiling cfg-if v1.0.0
</span></span><span class=line><span class=cl>   Compiling log v0.4.17
</span></span><span class=line><span class=cl>   <span class=c1># ... 省略</span>
</span></span><span class=line><span class=cl>   Compiling hyper v0.14.19
</span></span><span class=line><span class=cl>   Compiling axum v0.5.6
</span></span><span class=line><span class=cl>   Compiling hyper-timeout v0.4.1
</span></span><span class=line><span class=cl>   Compiling tonic v0.7.2
</span></span><span class=line><span class=cl>    Finished dev <span class=o>[</span>unoptimized + debuginfo<span class=o>]</span> target<span class=o>(</span>s<span class=o>)</span> in 21.01s
</span></span></code></pre></div><p>如果编译通过，现在我们可以尝试执行编译好的程序了。</p><p>首先启动 gRPC 服务端程序：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>$ cargo run --bin user-server
</span></span><span class=line><span class=cl>    Finished dev <span class=o>[</span>unoptimized + debuginfo<span class=o>]</span> target<span class=o>(</span>s<span class=o>)</span> in 0.04s
</span></span><span class=line><span class=cl>     Running <span class=sb>`</span>target/debug/user-server<span class=sb>`</span>
</span></span><span class=line><span class=cl>UserService listening on 127.0.0.1:50051
</span></span></code></pre></div><p>重新打开一个 terminal 窗口并执行客户端程序：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>$ cargo run --bin user-client
</span></span><span class=line><span class=cl>    Finished dev <span class=o>[</span>unoptimized + debuginfo<span class=o>]</span> target<span class=o>(</span>s<span class=o>)</span> in 0.05s
</span></span><span class=line><span class=cl>     Running <span class=sb>`</span>target/debug/user-client<span class=sb>`</span>
</span></span><span class=line><span class=cl><span class=nv>RESPONSE</span><span class=o>=</span>Response <span class=o>{</span> metadata: MetadataMap <span class=o>{</span> headers: <span class=o>{</span><span class=s2>&#34;content-type&#34;</span>: <span class=s2>&#34;application/grpc&#34;</span>, <span class=s2>&#34;date&#34;</span>: <span class=s2>&#34;Sun, 29 May 2022 21:54:18 GMT&#34;</span>, <span class=s2>&#34;grpc-status&#34;</span>: <span class=s2>&#34;0&#34;</span><span class=o>}</span> <span class=o>}</span>, message: HelloReply <span class=o>{</span> message: <span class=s2>&#34;Hello Rick!&#34;</span> <span class=o>}</span>, extensions: Extensions <span class=o>}</span> <span class=c1># &lt;- 客户端请求成功并返回响应</span>
</span></span></code></pre></div><p>此时我们切回服务端 terminal 窗口查看日志：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl><span class=c1># ...</span>
</span></span><span class=line><span class=cl>UserService listening on 127.0.0.1:50051
</span></span><span class=line><span class=cl>New user request from Some<span class=o>(</span>127.0.0.1:52147<span class=o>)</span> <span class=c1># &lt;- 客户端调用成功</span>
</span></span></code></pre></div><p>至此，一个简单的基于 Rust 的 gRPC 服务端/客户端就实现了。上述代码很简陋，相信只要是接触过 gRPC 的同学都比较容易就可以理解。</p></div><footer class=post-footer><ul class=post-tags><li><a href=https://lvlv.fun/tags/grpc/>GRPC</a></li><li><a href=https://lvlv.fun/tags/rust/>Rust</a></li><li><a href=https://lvlv.fun/tags/microservices/>Microservices</a></li></ul><nav class=paginav><a class=next href=https://lvlv.fun/posts/2022-05-21/><span class=title>Next »</span><br><span>JavaScript 批量删除 Bilibili 动态</span></a></nav></footer></article></main><footer class=footer><span>&copy; 2024 <a href=https://lvlv.fun/>Lv's Playground</a></span> ·
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="copy";function s(){t.innerHTML="copied!",setTimeout(()=>{t.innerHTML="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>