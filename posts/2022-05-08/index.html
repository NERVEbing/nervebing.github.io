<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>基于 HPE MicroServer Gen10 Plus 的 HomeLab 搭建 - 硬件篇 | Lv's Playground</title><meta name=keywords content="HomeLab,Gen10 Plus"><meta name=description content="前言 声明 本文是个人对 HomeLab 即家庭私有实验室的学习探索，参杂着一些经验总结，记录下来，也希望可以让他人少走一些弯路。
HomeLab 是什么？ 本质上是一个连接各种设备的复杂系统，你可以用任何树莓派/PC/服务器/路由器组成一个 HomeLab。
HomeLab 能做什么？ 搭建属于私人的网盘，不必在各个设备上安装云盘 App 才能上传/下载文件 不受版权控制的家庭多媒体，集成影视订阅，实现观影追剧自由 集成 HomeBridge 以实现在 iOS/macOS 的 Home.app 中操作非 HomeKit 认证的设备 BT 下载器，无需开启个人电脑，后台下载资源 RSS 订阅器，抛弃无意义地刷手机，只获取自己想要的内容 bilibili/京东每日任务，各种脚本反薅资本家的羊毛 最重要的是你可以搭建包括但不限于 K8S/ELK/MySQL/Redis/Prometheus 等各种服务，也可以在上面跑 CI/CD 自动化构建发布你的代码 阅读门槛 基本的网络知识，比如光猫和路由器的区别，交换机的作用是什么 基本的 Linux 操作，可以理解计算机不是一定要连接显示器才可以操作 遇到问题先使用英文进行 Google，内容过长可以开启页面翻译，请不要看 CSDN 的内容 不求甚解，当你发现你让它跑起来了的时候，会获得极大的心理满足感 设备 架构说明 主要分为服务器和网络设备。考虑到网络设备的稳定性及网络隔离对整套系统的重要程度，没有采用虚拟化 AIO(ALL IN ONE) 方案。
作为服务端开发者看来所谓的 AIO 毫无稳定性可言，ESXi 的 OpenWrt 虚拟机出了故障会影响其他业务虚拟机的运行，甚至连 iLO 后台都进不去，需要连接显示器手动配置 ESXi 进行修复，这种情况在异地操作 HomeLab 节点的时候是毁灭性的灾难。
当然这种方式的好处也有：网络上的 教程 较多，按视频操作一步步做几乎没有难点，小白也能轻松搭建。
缺点就是对整体的 HomeLab 环境一知半解甚至根本不懂，只会复制粘贴。当然你可以说“我只是想快速搭建一整套服务，不想了解细节”，这样的话本文可能不适合你。
服务器 首先是最重要的服务器部分，绝大多数设备购入时间为 2021年2-3月，价格相比当前可能有很大差距，费用清单如下："><meta name=author content="L"><link rel=canonical href=https://lvlv.fun/posts/2022-05-08/><link crossorigin=anonymous href=/assets/css/stylesheet.css rel="preload stylesheet" as=style><link rel=icon href=https://lvlv.fun/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://lvlv.fun/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://lvlv.fun/favicon-32x32.png><link rel=apple-touch-icon href=https://lvlv.fun/apple-touch-icon.png><link rel=mask-icon href=https://lvlv.fun/apple-touch-icon.png><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><noscript><style>#theme-toggle,.top-link{display:none}</style></noscript><script async src=//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js></script><meta property="og:title" content="基于 HPE MicroServer Gen10 Plus 的 HomeLab 搭建 - 硬件篇"><meta property="og:description" content="前言 声明 本文是个人对 HomeLab 即家庭私有实验室的学习探索，参杂着一些经验总结，记录下来，也希望可以让他人少走一些弯路。
HomeLab 是什么？ 本质上是一个连接各种设备的复杂系统，你可以用任何树莓派/PC/服务器/路由器组成一个 HomeLab。
HomeLab 能做什么？ 搭建属于私人的网盘，不必在各个设备上安装云盘 App 才能上传/下载文件 不受版权控制的家庭多媒体，集成影视订阅，实现观影追剧自由 集成 HomeBridge 以实现在 iOS/macOS 的 Home.app 中操作非 HomeKit 认证的设备 BT 下载器，无需开启个人电脑，后台下载资源 RSS 订阅器，抛弃无意义地刷手机，只获取自己想要的内容 bilibili/京东每日任务，各种脚本反薅资本家的羊毛 最重要的是你可以搭建包括但不限于 K8S/ELK/MySQL/Redis/Prometheus 等各种服务，也可以在上面跑 CI/CD 自动化构建发布你的代码 阅读门槛 基本的网络知识，比如光猫和路由器的区别，交换机的作用是什么 基本的 Linux 操作，可以理解计算机不是一定要连接显示器才可以操作 遇到问题先使用英文进行 Google，内容过长可以开启页面翻译，请不要看 CSDN 的内容 不求甚解，当你发现你让它跑起来了的时候，会获得极大的心理满足感 设备 架构说明 主要分为服务器和网络设备。考虑到网络设备的稳定性及网络隔离对整套系统的重要程度，没有采用虚拟化 AIO(ALL IN ONE) 方案。
作为服务端开发者看来所谓的 AIO 毫无稳定性可言，ESXi 的 OpenWrt 虚拟机出了故障会影响其他业务虚拟机的运行，甚至连 iLO 后台都进不去，需要连接显示器手动配置 ESXi 进行修复，这种情况在异地操作 HomeLab 节点的时候是毁灭性的灾难。
当然这种方式的好处也有：网络上的 教程 较多，按视频操作一步步做几乎没有难点，小白也能轻松搭建。
缺点就是对整体的 HomeLab 环境一知半解甚至根本不懂，只会复制粘贴。当然你可以说“我只是想快速搭建一整套服务，不想了解细节”，这样的话本文可能不适合你。
服务器 首先是最重要的服务器部分，绝大多数设备购入时间为 2021年2-3月，价格相比当前可能有很大差距，费用清单如下："><meta property="og:type" content="article"><meta property="og:url" content="https://lvlv.fun/posts/2022-05-08/"><meta property="og:image" content="https://cloud.lvlv.fun:10000/public/post/Gen10P-1.jpg"><meta property="article:section" content="posts"><meta property="article:published_time" content="2022-05-08T11:09:36+08:00"><meta property="article:modified_time" content="2022-05-08T11:09:36+08:00"><meta property="og:site_name" content="Lv's Playground"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://cloud.lvlv.fun:10000/public/post/Gen10P-1.jpg"><meta name=twitter:title content="基于 HPE MicroServer Gen10 Plus 的 HomeLab 搭建 - 硬件篇"><meta name=twitter:description content="前言 声明 本文是个人对 HomeLab 即家庭私有实验室的学习探索，参杂着一些经验总结，记录下来，也希望可以让他人少走一些弯路。
HomeLab 是什么？ 本质上是一个连接各种设备的复杂系统，你可以用任何树莓派/PC/服务器/路由器组成一个 HomeLab。
HomeLab 能做什么？ 搭建属于私人的网盘，不必在各个设备上安装云盘 App 才能上传/下载文件 不受版权控制的家庭多媒体，集成影视订阅，实现观影追剧自由 集成 HomeBridge 以实现在 iOS/macOS 的 Home.app 中操作非 HomeKit 认证的设备 BT 下载器，无需开启个人电脑，后台下载资源 RSS 订阅器，抛弃无意义地刷手机，只获取自己想要的内容 bilibili/京东每日任务，各种脚本反薅资本家的羊毛 最重要的是你可以搭建包括但不限于 K8S/ELK/MySQL/Redis/Prometheus 等各种服务，也可以在上面跑 CI/CD 自动化构建发布你的代码 阅读门槛 基本的网络知识，比如光猫和路由器的区别，交换机的作用是什么 基本的 Linux 操作，可以理解计算机不是一定要连接显示器才可以操作 遇到问题先使用英文进行 Google，内容过长可以开启页面翻译，请不要看 CSDN 的内容 不求甚解，当你发现你让它跑起来了的时候，会获得极大的心理满足感 设备 架构说明 主要分为服务器和网络设备。考虑到网络设备的稳定性及网络隔离对整套系统的重要程度，没有采用虚拟化 AIO(ALL IN ONE) 方案。
作为服务端开发者看来所谓的 AIO 毫无稳定性可言，ESXi 的 OpenWrt 虚拟机出了故障会影响其他业务虚拟机的运行，甚至连 iLO 后台都进不去，需要连接显示器手动配置 ESXi 进行修复，这种情况在异地操作 HomeLab 节点的时候是毁灭性的灾难。
当然这种方式的好处也有：网络上的 教程 较多，按视频操作一步步做几乎没有难点，小白也能轻松搭建。
缺点就是对整体的 HomeLab 环境一知半解甚至根本不懂，只会复制粘贴。当然你可以说“我只是想快速搭建一整套服务，不想了解细节”，这样的话本文可能不适合你。
服务器 首先是最重要的服务器部分，绝大多数设备购入时间为 2021年2-3月，价格相比当前可能有很大差距，费用清单如下："><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":2,"name":"Posts","item":"https://lvlv.fun/posts/"},{"@type":"ListItem","position":3,"name":"基于 HPE MicroServer Gen10 Plus 的 HomeLab 搭建 - 硬件篇","item":"https://lvlv.fun/posts/2022-05-08/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"基于 HPE MicroServer Gen10 Plus 的 HomeLab 搭建 - 硬件篇","name":"基于 HPE MicroServer Gen10 Plus 的 HomeLab 搭建 - 硬件篇","description":"前言 声明 本文是个人对 HomeLab 即家庭私有实验室的学习探索，参杂着一些经验总结，记录下来，也希望可以让他人少走一些弯路。\nHomeLab 是什么？ 本质上是一个连接各种设备的复杂系统，你可以用任何树莓派/PC/服务器/路由器组成一个 HomeLab。\nHomeLab 能做什么？ 搭建属于私人的网盘，不必在各个设备上安装云盘 App 才能上传/下载文件 不受版权控制的家庭多媒体，集成影视订阅，实现观影追剧自由 集成 HomeBridge 以实现在 iOS/macOS 的 Home.app 中操作非 HomeKit 认证的设备 BT 下载器，无需开启个人电脑，后台下载资源 RSS 订阅器，抛弃无意义地刷手机，只获取自己想要的内容 bilibili/京东每日任务，各种脚本反薅资本家的羊毛 最重要的是你可以搭建包括但不限于 K8S/ELK/MySQL/Redis/Prometheus 等各种服务，也可以在上面跑 CI/CD 自动化构建发布你的代码 阅读门槛 基本的网络知识，比如光猫和路由器的区别，交换机的作用是什么 基本的 Linux 操作，可以理解计算机不是一定要连接显示器才可以操作 遇到问题先使用英文进行 Google，内容过长可以开启页面翻译，请不要看 CSDN 的内容 不求甚解，当你发现你让它跑起来了的时候，会获得极大的心理满足感 设备 架构说明 主要分为服务器和网络设备。考虑到网络设备的稳定性及网络隔离对整套系统的重要程度，没有采用虚拟化 AIO(ALL IN ONE) 方案。\n作为服务端开发者看来所谓的 AIO 毫无稳定性可言，ESXi 的 OpenWrt 虚拟机出了故障会影响其他业务虚拟机的运行，甚至连 iLO 后台都进不去，需要连接显示器手动配置 ESXi 进行修复，这种情况在异地操作 HomeLab 节点的时候是毁灭性的灾难。\n当然这种方式的好处也有：网络上的 教程 较多，按视频操作一步步做几乎没有难点，小白也能轻松搭建。\n缺点就是对整体的 HomeLab 环境一知半解甚至根本不懂，只会复制粘贴。当然你可以说“我只是想快速搭建一整套服务，不想了解细节”，这样的话本文可能不适合你。\n服务器 首先是最重要的服务器部分，绝大多数设备购入时间为 2021年2-3月，价格相比当前可能有很大差距，费用清单如下：","keywords":["HomeLab","Gen10 Plus"],"articleBody":"前言 声明 本文是个人对 HomeLab 即家庭私有实验室的学习探索，参杂着一些经验总结，记录下来，也希望可以让他人少走一些弯路。\nHomeLab 是什么？ 本质上是一个连接各种设备的复杂系统，你可以用任何树莓派/PC/服务器/路由器组成一个 HomeLab。\nHomeLab 能做什么？ 搭建属于私人的网盘，不必在各个设备上安装云盘 App 才能上传/下载文件 不受版权控制的家庭多媒体，集成影视订阅，实现观影追剧自由 集成 HomeBridge 以实现在 iOS/macOS 的 Home.app 中操作非 HomeKit 认证的设备 BT 下载器，无需开启个人电脑，后台下载资源 RSS 订阅器，抛弃无意义地刷手机，只获取自己想要的内容 bilibili/京东每日任务，各种脚本反薅资本家的羊毛 最重要的是你可以搭建包括但不限于 K8S/ELK/MySQL/Redis/Prometheus 等各种服务，也可以在上面跑 CI/CD 自动化构建发布你的代码 阅读门槛 基本的网络知识，比如光猫和路由器的区别，交换机的作用是什么 基本的 Linux 操作，可以理解计算机不是一定要连接显示器才可以操作 遇到问题先使用英文进行 Google，内容过长可以开启页面翻译，请不要看 CSDN 的内容 不求甚解，当你发现你让它跑起来了的时候，会获得极大的心理满足感 设备 架构说明 主要分为服务器和网络设备。考虑到网络设备的稳定性及网络隔离对整套系统的重要程度，没有采用虚拟化 AIO(ALL IN ONE) 方案。\n作为服务端开发者看来所谓的 AIO 毫无稳定性可言，ESXi 的 OpenWrt 虚拟机出了故障会影响其他业务虚拟机的运行，甚至连 iLO 后台都进不去，需要连接显示器手动配置 ESXi 进行修复，这种情况在异地操作 HomeLab 节点的时候是毁灭性的灾难。\n当然这种方式的好处也有：网络上的 教程 较多，按视频操作一步步做几乎没有难点，小白也能轻松搭建。\n缺点就是对整体的 HomeLab 环境一知半解甚至根本不懂，只会复制粘贴。当然你可以说“我只是想快速搭建一整套服务，不想了解细节”，这样的话本文可能不适合你。\n服务器 首先是最重要的服务器部分，绝大多数设备购入时间为 2021年2-3月，价格相比当前可能有很大差距，费用清单如下：\n设备 价格(元) 数量 备注 HPE Gen10 Plus G5420/8GB 4000 1 淘宝/德国转运 iLO5 NIC Kit 399 1 同上 Intel Xeon E-2146G 1400 1 淘宝/QS版 海力士 32GB DDR4 2666MHz ECC 2600 2 淘宝 希捷 Exos X18 16TB 4200 2 淘宝/国行 英睿达 MX500 SATA SSD 2TB 2400 2 京东自营 三星 PM991 256GB + 佳翼硬盘盒 300 1 PM991闲鱼/硬盘盒京东 三星 850PRO SATA SSD 256G 0 2 家用闲置 Intel 傲腾 NVMe SSD 16GB 0 2 家用闲置 Intel 奔腾 G5420 -488 1 闲鱼出了 HPE 原装海力士 8GB ECC -300 1 闲鱼出了 盈通 GTX1650 4GB DDR6 85 1 1535购入/1450出了 佳翼 NVMe 4X4 阵列卡 1200 1 淘宝 总计 15796 之前没怎么认真统计花费，看到总计后还是惊了一下，老实说这个价格可以上塔式服务器或者洋垃圾 DIY。选择 Gen10 Plus 的理由无外乎精致/美观/静音，毕竟这是一台可以放在卧室的服务器。\n总的来说硬盘/存储占比重较大，当前情况下的配置不是最终配置，目的也仅仅是为了满足个人需求。\n如果能把硬盘换成 SATA SSD 4TB * 4 会更好，当然 NVMe 阵列卡插满4条 m.2 也可，主做 NAS 服务器的话直接更换为 10G/25G/40G 网卡。配置是为了匹配实际用途，否则就是卑鄙地浪费。\n主机 主机从下单到收货前前后后差不多一个月的时间。 开箱，高贵的日耳曼甜美空气扑面而来(doge)。\n即使在公司加班也阻止不了我欣赏它的美。\n拧开快拆螺丝，欣赏大厂的工整做工，简直是一件艺术品。\nCPU 首先我们要知道 Gen10 Plus 的 DC 电源是 180W，在官方高配也就是 Intel E-2224/16GB/单SSD 的情况下整机功耗能达到 110W，最多只能留下 70W 的可用空间。考虑到电源转换效率以及需要留点余量(20W)，这样我们可以操作的空间就只剩下 50W。\n每一块希捷 Exos X18 16TB 的待机功耗大概是 5W，满载功耗是 10W，4块满载 40W，这么看来光是硬盘塞满的情况下电源就已经快撑不住了，更别提上个网卡或显卡了。\n然而事实是我们不会让服务器始终跑在 100% 的负载下，也就是说功耗峰值不代表日常功耗。根据我目前的配置，待机功耗在 35W 左右，目前跑了 20+ 个服务的情况下也不过 50W，程序的 CPU 占用率也可以在 docker 命令中加以限制。\n现在我们再来看 CPU 的选择：\n上图来自 servethehome.com 的 HPE ProLiant MicroServer Gen10 Plus Ultimate Customization Guide 一文，是一篇非常好的 HPE Gen10 Plus 设备选择指导。\n根据 servethehome.com 的测试结果，当使用 E-2288G/64GB/单SSD 在 Windows Server 2019 上跑 Prime95 时，功率计上的数值达到了 194.5W，所以 8核16线程 直接排除。\n由于跑大量服务需要更多的核心/线程数，并且官方高配就是 4核4线程，所以我们筛选 6核12线程 的 CPU 如下：\n型号 核心/线程数 频率 TDP(W) 基准 E-2224 4C/4T 3.4-4.6GHz 71W E-2276G 6C/12T 3.8-4.9GHz 80W E-2246G 6C/12T 3.6-4.8GHz 80W E-2236 6C/12T 3.4-4.8GHz 80W E-2176G 6C/12T 3.7-4.7GHz 80W E-2146G 6C/12T 3.5-4.5GHz 80W E-2136 6C/12T 3.3-4.5GHz 80W 最好的选择当然是 E-2276G，但当时 E-22XX 系列太贵了，而且 Intel Xeon 8代与9代性能差距不大，所以范围缩小成了 E-2176G、E-2146G、E-2136 三款。\n根据 CPU Benchmarks 的对比结果来看三款在跑分上基本上可以说是没什么差距，由于 E-2146G 相比 E-2136 多了核显，虽然 Gen10 Plus 主板屏蔽了核显，但以后可以等 E-2278G 价格亲民后进行置换，拆下来 E-2146G 可以给别的机器用，所以最终选择了 E-2146G。\n淘宝 1400 拿下 E-2146G QS 正显，步进和正式版相同 e4，成色相当之好，插上点亮。\niLO 中处理器信息一切正常。\n稍微测了下，睿频 4.5GHz，全核心满载 4.2GHz，此时 CPU 温度 85度 左右，插座显示 120W，对这个结果相当满意。\n内存 HPE Gen10 Plus 官方产品页上写的最大支持内存是 32GB，实测支持 64GB，且不像 Gen8，Gen10 Plus 支持非 ECC 内存，给预算不充足的玩家留足了余地。\nHPE 的原装内存是海力士的 8GB DDR4 ECC 2666MHz，在奔腾 G5420 下只能以 2400MHz 运行，不多说直接挂闲鱼。\n32GB 纯 ECC 内存的选择有三星和海力士。三星由于贴牌寨条较多，正品库存少不好买，海力士也是 HPE 认证内存厂商，所以选择了后者。\niLO 内存信息，64GB DDR4 2666MHz ECC，双通道运行。\n奇怪的是制造商一栏显示不适用，但其他信息完全正常，Reddit 上查到只有官方部件号的 16GB 单条才有制造商信息，无所谓了。\n硬盘 HDD HDD 选择了两块加拿大白嫖王多次认证的 希捷 Exos X18 16TB，没什么好说的。购入的时候单价 2100(2021.3)，一个月后 Chia 大火价格翻了一倍，目前价格降到了 1800(2022.5) 左右，早知道当时应该出了。\n出色的稳定性和相对较低的磁盘共振噪音让 Exos X18 依旧相较于 WD Ultrastar DC HC550 来说是更好的选择。\nsmartctl -a /dev/sda |grep Temperature_Celsius Temperature_Celsius 33 smartctl -a /dev/sdb |grep Temperature_Celsius Temperature_Celsius 34 日常待机温度也让人相当安心。\n悲催的是其中一块在插到另一台机器上调试的时候，SATA 接口附近的塑料片被带掉了下来。联系了售后，要上海解封后才能换接口，先用一块三星 850 PRO 256G 做系统盘。\nSSD 既然要跑服务，HDD 的读写速度当然是不够看的。Intel D3-S4610、Intel D3-S4510 等企业级 SSD 除了贵没有任何缺点，但闲鱼上全是高强度锻炼清零盘，实在让人买不下手。\n于是目光转向便宜大碗的京东自营 英睿达 MX500 2TB。\n刚好有活动单价 1199 拿下，5年质保。英睿达京东自营算是全球指定售后点，出了问题基本上直接换新。\nPCIe PCIe 插槽的选择是最让人纠结的地方，由于 Gen10 Plus 内部只有一个 PCIe 3.0 X16 单槽/半高插槽，能使用的配件主要有下面几个类型：\n显卡 网卡 SAS卡 PCIe SSD/PCIe 转 NVMe 转接卡 显卡 选择显卡的理由显而易见：可以硬解 Jellyfin/Emby；可以跑 CUDA；可以虚拟化环境中直通到 Windows 打游戏。\n功耗是不得不考虑的问题，PCIe X16 可提供功耗为 70W，高负载模式下对 Gen10 Plus 的供电来说是不小的挑战。\n本人为了硬解视频先后尝试了 Radeon RX550/GeForce GTX 1650，总的来说 ESXi 环境中A卡的兼容性会好一些，但在特定的应用中转换效率较低；N卡(指1650这样的非专业卡)在 ESXi7.0 中的表现极差，费劲直通到 Windows 却做不到持久化，虚拟机重启就会失效，说到底还是 ESXi 对消费级显卡的不兼容，但在纯 docker 环境中N卡的视频解码表现远比A卡要强。\n上图为盈通 GeForce GTX1650 4GB DDR6，目前 (2022.1) 不用外接电源单槽半高最强显卡，HTPC 最优选择，支持各种视频解码。145mm 全长/纯铜散热片，做工扎实，丽台同款价格 2699，除了 logo 其他完全一样。\n网卡 由于 2.5G/5G 都可以通过 USB3.0 的方式转换，这里推荐 威联通（QNAP）5G转换器，在 Linux 下也有很好的兼容性。\n10G(万兆) 分为 电口(RJ45) 和 光口(SFP+)，Gen10 Plus 的 PCIe 区域是没有风道的，从功耗和散热来说，光口更值得推荐。如果有主做 NAS 需求的话，推荐 Intel X710-DA4，但记得同时购入光转电模块。\n25G 及以上不在本文讨论范围内。\nSAS卡 除非有非常强烈的硬 RAID 需求，否则不推荐 SAS卡占用唯一的 PCIe 插槽这样的宝贵资源。\nPCIe SSD/PCIe 转 NVMe 转接卡 PCIe SSD 可以选择 Intel DC P3608 或 Intel 傲腾 SSD 905P，但这类企业级 PCIe 太贵了，比较常用的做法是 PCIe 转 NVMe 转接卡类似 佳翼冷雨燕NVMe转接卡 这类经济实惠的方案。\n需要注意的是，如果想要 PCIe 转接多条 m.2 NVMe 的话，需要购买自带主控芯片的拆分卡，我的选择是 佳翼 NVMe阵列卡 4x4 SSD PCIE转M.2转接卡。\n自带 ASM2824 主控支持拆分，不挑主板，带涡轮风扇。热量主要来自 SSD 的芯片和主控，加上 PCIe 区域通风不佳，散热只能说马马虎虎，不是这张卡的问题。\nsmartctl -a /dev/nvme0n1 |grep Temperature Temperature: 52 Celsius smartctl -a /dev/nvme1n1 |grep Temperature Temperature: 53 Celsius 风扇转速 14% 的情况下，最热的 07-BMC 其实是 iLO 芯片，下面的 10-PCI 1 Zone 在低负载下其实温度还行。\n网络设备 OpenWrt 比较推荐 J4125 四口 2.5G 软路由，比如 康耐信J4125 I225-V 2.5G 这款，看评测比倍控的方案散热好一些，日后换 2.5G 口的 AP 也比较合适。\n有树莓派的话也可以用树莓派，做个类似这样的方案：\n树莓派4B + 5口千兆交换机 + USB千兆网卡，小巧又精致。\n由于老家是老房子，装修的时候还是百兆网线，手头一个 斐讯N1 就够用了。\n固件选择 kiddin9 或者 gd0772。\nWi-Fi Mesh 目前是 红米AX6S + 小米AX1800 组 Mesh，对 Wi-Fi 速率需求没那么高，信号覆盖范围广就可以。\n其他 UPS 不间断电源 UPS 选择的是 APC BK650M2-CH，390W 带 服务器 + 路由器 + 交换机足够用了。\n# apt安装守护进程 sudo apt install -y apcupsd # 修改配置文件后保存 sudo vim /etc/apcupsd/apcupsd.conf UPSNAME APC-BK650M2 # 随意修改 UPSCABLE usb UPSTYPE usb DEVICE # 留空 # 重启服务 systemctl restart apcupsd.service # 查看运行情况 apcaccess APC : 001,036,0873 DATE : 2022-05-12 15:09:50 +0800 HOSTNAME : lvlv-Gen10Plus VERSION : 3.14.14 (31 May 2016) debian UPSNAME : APC-BK650M2 CABLE : USB Cable DRIVER : USB UPS Driver UPSMODE : Stand Alone STARTTIME: 2022-05-07 09:48:38 +0800 MODEL : Back-UPS BK650M2-CH STATUS : ONLINE LINEV : 235.0 Volts LOADPCT : 13.0 Percent BCHARGE : 100.0 Percent TIMELEFT : 29.9 Minutes MBATTCHG : 5 Percent MINTIMEL : 3 Minutes MAXTIME : 0 Seconds SENSE : Low LOTRANS : 160.0 Volts HITRANS : 278.0 Volts ALARMDEL : 30 Seconds BATTV : 13.5 Volts LASTXFER : No transfers since turnon NUMXFERS : 0 TONBATT : 0 Seconds CUMONBATT: 0 Seconds XOFFBATT : N/A SELFTEST : NG STATFLAG : 0x05000008 SERIALNO : 9B2131A03464 BATTDATE : 2001-01-01 NOMINV : 220 Volts NOMBATTV : 12.0 Volts NOMPOWER : 390 Watts FIRMWARE : 294803G -292804G END APC : 2022-05-12 15:10:03 +0800 ","wordCount":"826","inLanguage":"en","image":"https://cloud.lvlv.fun:10000/public/post/Gen10P-1.jpg","datePublished":"2022-05-08T11:09:36+08:00","dateModified":"2022-05-08T11:09:36+08:00","author":{"@type":"Person","name":"L"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://lvlv.fun/posts/2022-05-08/"},"publisher":{"@type":"Organization","name":"Lv's Playground","logo":{"@type":"ImageObject","url":"https://lvlv.fun/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://lvlv.fun accesskey=h title="Started (Alt + H)"><img src=https://lvlv.fun/apple-touch-icon.png alt aria-label=logo height=35>Started</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://lvlv.fun/navigation/ title=Navigation><span>Navigation</span></a></li><li><a href=https://lvlv.fun/live/ title=Live><span>Live</span></a></li><li><a href=https://lvlv.fun/archives/ title=Archives><span>Archives</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://lvlv.fun>Home</a>&nbsp;»&nbsp;<a href=https://lvlv.fun/posts/>Posts</a></div><h1 class=post-title>基于 HPE MicroServer Gen10 Plus 的 HomeLab 搭建 - 硬件篇</h1><div class=post-meta><span title='2022-05-08 11:09:36 +0800 +0800'>2022-05-08</span>&nbsp;·&nbsp;4 min&nbsp;·&nbsp;L&nbsp;|&nbsp;<a href=https://github.com/NERVEbing/blog/blob/master/content/posts/2022-05-08.md rel="noopener noreferrer" target=_blank>Suggest Changes</a></div></header><figure class=entry-cover><img loading=lazy src=https://cloud.lvlv.fun:10000/public/post/Gen10P-1.jpg alt></figure><div class=toc><details><summary accesskey=c title="(Alt + C)"><span class=details>Table of Contents</span></summary><div class=inner><ul><li><a href=#%e5%89%8d%e8%a8%80 aria-label=前言>前言</a><ul><li><a href=#%e5%a3%b0%e6%98%8e aria-label=声明>声明</a></li><li><a href=#homelab-%e6%98%af%e4%bb%80%e4%b9%88 aria-label="HomeLab 是什么？">HomeLab 是什么？</a></li><li><a href=#homelab-%e8%83%bd%e5%81%9a%e4%bb%80%e4%b9%88 aria-label="HomeLab 能做什么？">HomeLab 能做什么？</a></li><li><a href=#%e9%98%85%e8%af%bb%e9%97%a8%e6%a7%9b aria-label=阅读门槛>阅读门槛</a></li></ul></li><li><a href=#%e8%ae%be%e5%a4%87 aria-label=设备>设备</a><ul><li><a href=#%e6%9e%b6%e6%9e%84%e8%af%b4%e6%98%8e aria-label=架构说明>架构说明</a></li><li><a href=#%e6%9c%8d%e5%8a%a1%e5%99%a8 aria-label=服务器>服务器</a><ul><li><a href=#%e4%b8%bb%e6%9c%ba aria-label=主机>主机</a></li><li><a href=#cpu aria-label=CPU>CPU</a></li><li><a href=#%e5%86%85%e5%ad%98 aria-label=内存>内存</a></li><li><a href=#%e7%a1%ac%e7%9b%98 aria-label=硬盘>硬盘</a><ul><li><a href=#hdd aria-label=HDD>HDD</a></li><li><a href=#ssd aria-label=SSD>SSD</a></li></ul></li><li><a href=#pcie aria-label=PCIe>PCIe</a><ul><li><a href=#%e6%98%be%e5%8d%a1 aria-label=显卡>显卡</a></li><li><a href=#%e7%bd%91%e5%8d%a1 aria-label=网卡>网卡</a></li><li><a href=#sas%e5%8d%a1 aria-label=SAS卡>SAS卡</a></li><li><a href=#pcie-ssdpcie-%e8%bd%ac-nvme-%e8%bd%ac%e6%8e%a5%e5%8d%a1 aria-label="PCIe SSD/PCIe 转 NVMe 转接卡">PCIe SSD/PCIe 转 NVMe 转接卡</a></li></ul></li></ul></li><li><a href=#%e7%bd%91%e7%bb%9c%e8%ae%be%e5%a4%87 aria-label=网络设备>网络设备</a><ul><li><a href=#openwrt aria-label=OpenWrt>OpenWrt</a></li><li><a href=#wi-fi-mesh aria-label="Wi-Fi Mesh">Wi-Fi Mesh</a></li></ul></li><li><a href=#%e5%85%b6%e4%bb%96 aria-label=其他>其他</a><ul><li><a href=#ups-%e4%b8%8d%e9%97%b4%e6%96%ad%e7%94%b5%e6%ba%90 aria-label="UPS 不间断电源">UPS 不间断电源</a></li></ul></li></ul></li></ul></div></details></div><div class=post-content><h1 id=前言>前言<a hidden class=anchor aria-hidden=true href=#前言>#</a></h1><h2 id=声明>声明<a hidden class=anchor aria-hidden=true href=#声明>#</a></h2><p>本文是个人对 <a href=https://www.seeedstudio.com/blog/2020/12/22/what-is-a-home-lab-getting-started-and-recommendations/><em><strong>HomeLab</strong></em></a> 即家庭私有实验室的学习探索，参杂着一些经验总结，记录下来，也希望可以让他人少走一些弯路。</p><h2 id=homelab-是什么>HomeLab 是什么？<a hidden class=anchor aria-hidden=true href=#homelab-是什么>#</a></h2><p>本质上是一个连接各种设备的复杂系统，你可以用任何树莓派/PC/服务器/路由器组成一个 HomeLab。</p><h2 id=homelab-能做什么>HomeLab 能做什么？<a hidden class=anchor aria-hidden=true href=#homelab-能做什么>#</a></h2><ol><li>搭建属于私人的网盘，不必在各个设备上安装云盘 App 才能上传/下载文件</li><li>不受版权控制的家庭多媒体，集成影视订阅，实现观影追剧自由</li><li>集成 HomeBridge 以实现在 iOS/macOS 的 Home.app 中操作非 HomeKit 认证的设备</li><li>BT 下载器，无需开启个人电脑，后台下载资源</li><li>RSS 订阅器，抛弃无意义地刷手机，只获取自己想要的内容</li><li>bilibili/京东每日任务，各种脚本反薅资本家的羊毛</li><li>最重要的是你可以搭建包括但不限于 K8S/ELK/MySQL/Redis/Prometheus 等各种服务，也可以在上面跑 CI/CD 自动化构建发布你的代码</li></ol><h2 id=阅读门槛>阅读门槛<a hidden class=anchor aria-hidden=true href=#阅读门槛>#</a></h2><ol><li>基本的网络知识，比如光猫和路由器的区别，交换机的作用是什么</li><li>基本的 Linux 操作，可以理解计算机不是一定要连接显示器才可以操作</li><li>遇到问题先使用英文进行 Google，内容过长可以开启页面翻译，请不要看 CSDN 的内容</li><li>不求甚解，当你发现你让它跑起来了的时候，会获得极大的心理满足感</li></ol><h1 id=设备>设备<a hidden class=anchor aria-hidden=true href=#设备>#</a></h1><h2 id=架构说明>架构说明<a hidden class=anchor aria-hidden=true href=#架构说明>#</a></h2><p>主要分为服务器和网络设备。考虑到网络设备的稳定性及网络隔离对整套系统的重要程度，没有采用虚拟化 <a href=https://zhuanlan.zhihu.com/p/374163378><em><strong>AIO</strong></em></a>(ALL IN ONE) 方案。</p><p>作为服务端开发者看来所谓的 AIO 毫无稳定性可言，ESXi 的 OpenWrt 虚拟机出了故障会影响其他业务虚拟机的运行，甚至连 iLO 后台都进不去，需要连接显示器手动配置 ESXi 进行修复，这种情况在异地操作 HomeLab 节点的时候是毁灭性的灾难。</p><p>当然这种方式的好处也有：网络上的 <a href=https://www.bilibili.com/video/BV1GY41177Es>教程</a> 较多，按视频操作一步步做几乎没有难点，小白也能轻松搭建。</p><p>缺点就是对整体的 HomeLab 环境一知半解甚至根本不懂，只会复制粘贴。当然你可以说“我只是想快速搭建一整套服务，不想了解细节”，这样的话本文可能不适合你。</p><h2 id=服务器>服务器<a hidden class=anchor aria-hidden=true href=#服务器>#</a></h2><p>首先是最重要的服务器部分，绝大多数设备购入时间为 <strong>2021年2-3月</strong>，价格相比当前可能有很大差距，费用清单如下：</p><table><thead><tr><th>设备</th><th>价格(元)</th><th>数量</th><th>备注</th></tr></thead><tbody><tr><td>HPE Gen10 Plus G5420/8GB</td><td>4000</td><td>1</td><td>淘宝/德国转运</td></tr><tr><td>iLO5 NIC Kit</td><td>399</td><td>1</td><td>同上</td></tr><tr><td>Intel Xeon E-2146G</td><td>1400</td><td>1</td><td>淘宝/QS版</td></tr><tr><td>海力士 32GB DDR4 2666MHz ECC</td><td>2600</td><td>2</td><td>淘宝</td></tr><tr><td>希捷 Exos X18 16TB</td><td>4200</td><td>2</td><td>淘宝/国行</td></tr><tr><td>英睿达 MX500 SATA SSD 2TB</td><td>2400</td><td>2</td><td>京东自营</td></tr><tr><td>三星 PM991 256GB + 佳翼硬盘盒</td><td>300</td><td>1</td><td>PM991闲鱼/硬盘盒京东</td></tr><tr><td>三星 850PRO SATA SSD 256G</td><td>0</td><td>2</td><td>家用闲置</td></tr><tr><td>Intel 傲腾 NVMe SSD 16GB</td><td>0</td><td>2</td><td>家用闲置</td></tr><tr><td>Intel 奔腾 G5420</td><td>-488</td><td>1</td><td>闲鱼出了</td></tr><tr><td>HPE 原装海力士 8GB ECC</td><td>-300</td><td>1</td><td>闲鱼出了</td></tr><tr><td>盈通 GTX1650 4GB DDR6</td><td>85</td><td>1</td><td>1535购入/1450出了</td></tr><tr><td>佳翼 NVMe 4X4 阵列卡</td><td>1200</td><td>1</td><td>淘宝</td></tr><tr><td>总计</td><td>15796</td><td></td><td></td></tr></tbody></table><p>之前没怎么认真统计花费，看到总计后还是惊了一下，老实说这个价格可以上塔式服务器或者洋垃圾 DIY。选择 Gen10 Plus 的理由无外乎精致/美观/静音，毕竟这是一台可以放在卧室的服务器。</p><p>总的来说硬盘/存储占比重较大，当前情况下的配置不是最终配置，目的也仅仅是为了满足个人需求。</p><p>如果能把硬盘换成 SATA SSD 4TB * 4 会更好，当然 NVMe 阵列卡插满4条 m.2 也可，主做 NAS 服务器的话直接更换为 10G/25G/40G 网卡。配置是为了匹配实际用途，否则就是卑鄙地浪费。</p><h3 id=主机>主机<a hidden class=anchor aria-hidden=true href=#主机>#</a></h3><p>主机从下单到收货前前后后差不多一个月的时间。
<img loading=lazy src=https://cloud.lvlv.fun:10000/public/post/Gen10P-5.jpg#center alt></p><blockquote><p>开箱，高贵的日耳曼甜美空气扑面而来(doge)。</p></blockquote><p><img loading=lazy src=https://cloud.lvlv.fun:10000/public/post/Gen10P-6.jpg#center alt></p><blockquote><p>即使在公司加班也阻止不了我欣赏它的美。</p></blockquote><p><img loading=lazy src=https://cloud.lvlv.fun:10000/public/post/Gen10P-7.jpg#center alt></p><blockquote><p>拧开快拆螺丝，欣赏大厂的工整做工，简直是一件艺术品。</p></blockquote><h3 id=cpu>CPU<a hidden class=anchor aria-hidden=true href=#cpu>#</a></h3><p>首先我们要知道 Gen10 Plus 的 DC 电源是 180W，在官方高配也就是 Intel E-2224/16GB/单SSD 的情况下整机功耗能达到 110W，最多只能留下 70W 的可用空间。考虑到电源转换效率以及需要留点余量(20W)，这样我们可以操作的空间就只剩下 50W。</p><p>每一块希捷 Exos X18 16TB 的待机功耗大概是 5W，满载功耗是 10W，4块满载 40W，这么看来光是硬盘塞满的情况下电源就已经快撑不住了，更别提上个网卡或显卡了。</p><p>然而事实是我们不会让服务器始终跑在 100% 的负载下，也就是说功耗峰值不代表日常功耗。根据我目前的配置，待机功耗在 35W 左右，目前跑了 20+ 个服务的情况下也不过 50W，程序的 CPU 占用率也可以在 docker 命令中加以限制。</p><p>现在我们再来看 CPU 的选择：</p><p><img loading=lazy src=https://www.servethehome.com/wp-content/uploads/2020/03/HPE-ProLiant-MicroServer-Gen10-Plus-CPU-Superset.jpg#center alt="HPE ProLiant MicroServer Gen10 Plus Ultimate Customization Guide"></p><blockquote><p>上图来自 <a href=https://www.servethehome.com/>servethehome.com</a> 的 <a href=https://www.servethehome.com/hpe-proliant-microserver-gen10-plus-ultimate-customization-guide/1/>HPE ProLiant MicroServer Gen10 Plus Ultimate Customization Guide</a> 一文，是一篇非常好的 HPE Gen10 Plus 设备选择指导。</p></blockquote><p>根据 servethehome.com 的测试结果，当使用 E-2288G/64GB/单SSD 在 Windows Server 2019 上跑 Prime95 时，功率计上的数值达到了 194.5W，所以 8核16线程 直接排除。</p><p>由于跑大量服务需要更多的核心/线程数，并且官方高配就是 4核4线程，所以我们筛选 6核12线程 的 CPU 如下：</p><table><thead><tr><th>型号</th><th>核心/线程数</th><th>频率</th><th>TDP(W)</th></tr></thead><tbody><tr><td>基准 E-2224</td><td>4C/4T</td><td>3.4-4.6GHz</td><td>71W</td></tr><tr><td>E-2276G</td><td>6C/12T</td><td>3.8-4.9GHz</td><td>80W</td></tr><tr><td>E-2246G</td><td>6C/12T</td><td>3.6-4.8GHz</td><td>80W</td></tr><tr><td>E-2236</td><td>6C/12T</td><td>3.4-4.8GHz</td><td>80W</td></tr><tr><td>E-2176G</td><td>6C/12T</td><td>3.7-4.7GHz</td><td>80W</td></tr><tr><td>E-2146G</td><td>6C/12T</td><td>3.5-4.5GHz</td><td>80W</td></tr><tr><td>E-2136</td><td>6C/12T</td><td>3.3-4.5GHz</td><td>80W</td></tr></tbody></table><p>最好的选择当然是 E-2276G，但当时 E-22XX 系列太贵了，而且 Intel Xeon 8代与9代性能差距不大，所以范围缩小成了 E-2176G、E-2146G、E-2136 三款。</p><p><img loading=lazy src=https://cloud.lvlv.fun:10000/public/post/Intel-Xeon-E-2176G-vs-Intel-Xeon-E-2146G-vs-Intel-Xeon-E-2136.png#center alt></p><p>根据 <a href=https://www.cpubenchmark.net/compare/Intel-Xeon-E-2176G-vs-Intel-Xeon-E-2146G-vs-Intel-Xeon-E-2136/3336vs3314vs3363>CPU Benchmarks</a> 的对比结果来看三款在跑分上基本上可以说是没什么差距，由于 E-2146G 相比 E-2136 多了核显，虽然 Gen10 Plus 主板屏蔽了核显，但以后可以等 E-2278G 价格亲民后进行置换，拆下来 E-2146G 可以给别的机器用，所以最终选择了 E-2146G。</p><p><img loading=lazy src=https://cloud.lvlv.fun:10000/public/post/E2146G-1.jpg#center alt></p><blockquote><p>淘宝 1400 拿下 E-2146G QS 正显，步进和正式版相同 e4，成色相当之好，插上点亮。</p></blockquote><p><img loading=lazy src=https://cloud.lvlv.fun:10000/public/post/iLO-3.png#center alt></p><blockquote><p>iLO 中处理器信息一切正常。</p></blockquote><p><img loading=lazy src=https://cloud.lvlv.fun:10000/public/post/E2146G-2.jpg#center alt></p><blockquote><p>稍微测了下，睿频 4.5GHz，全核心满载 4.2GHz，此时 CPU 温度 85度 左右，插座显示 120W，对这个结果相当满意。</p></blockquote><h3 id=内存>内存<a hidden class=anchor aria-hidden=true href=#内存>#</a></h3><p>HPE Gen10 Plus 官方产品页上写的最大支持内存是 32GB，实测支持 64GB，且不像 Gen8，Gen10 Plus 支持非 ECC 内存，给预算不充足的玩家留足了余地。</p><p>HPE 的原装内存是海力士的 8GB DDR4 ECC 2666MHz，在奔腾 G5420 下只能以 2400MHz 运行，不多说直接挂闲鱼。</p><p>32GB 纯 ECC 内存的选择有三星和海力士。三星由于贴牌寨条较多，正品库存少不好买，海力士也是 HPE 认证内存厂商，所以选择了后者。</p><p><img loading=lazy src=https://cloud.lvlv.fun:10000/public/post/iLO-4.png#center alt></p><blockquote><p>iLO 内存信息，64GB DDR4 2666MHz ECC，双通道运行。</p></blockquote><p><img loading=lazy src=https://cloud.lvlv.fun:10000/public/post/iLO-5.png#center alt></p><blockquote><p>奇怪的是制造商一栏显示不适用，但其他信息完全正常，Reddit 上查到只有官方部件号的 16GB 单条才有制造商信息，无所谓了。</p></blockquote><h3 id=硬盘>硬盘<a hidden class=anchor aria-hidden=true href=#硬盘>#</a></h3><h4 id=hdd>HDD<a hidden class=anchor aria-hidden=true href=#hdd>#</a></h4><p>HDD 选择了两块加拿大白嫖王多次认证的 <a href=https://www.seagate.com/tw/zh/products/enterprise-drives/exos-x/x18/>希捷 Exos X18 16TB</a>，没什么好说的。购入的时候单价 2100(2021.3)，一个月后 Chia 大火价格翻了一倍，目前价格降到了 1800(2022.5) 左右，早知道当时应该出了。</p><p><img loading=lazy src=https://cloud.lvlv.fun:10000/public/post/Exos-X18-2.jpg#center alt></p><blockquote><p>出色的稳定性和相对较低的磁盘共振噪音让 Exos X18 依旧相较于 <a href=https://www.westerndigital.com/zh-tw/products/internal-drives/data-center-drives/ultrastar-dc-hc550-hdd#0F38356>WD Ultrastar DC HC550</a> 来说是更好的选择。</p></blockquote><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>smartctl -a /dev/sda <span class=p>|</span>grep Temperature_Celsius
</span></span><span class=line><span class=cl>Temperature_Celsius     <span class=m>33</span>
</span></span><span class=line><span class=cl>smartctl -a /dev/sdb <span class=p>|</span>grep Temperature_Celsius
</span></span><span class=line><span class=cl>Temperature_Celsius     <span class=m>34</span>
</span></span></code></pre></div><blockquote><p>日常待机温度也让人相当安心。</p></blockquote><p><img loading=lazy src=https://cloud.lvlv.fun:10000/public/post/Exos-X18-1.jpg#center alt></p><blockquote><p>悲催的是其中一块在插到另一台机器上调试的时候，SATA 接口附近的塑料片被带掉了下来。联系了售后，要上海解封后才能换接口，先用一块三星 850 PRO 256G 做系统盘。</p></blockquote><h4 id=ssd>SSD<a hidden class=anchor aria-hidden=true href=#ssd>#</a></h4><p>既然要跑服务，HDD 的读写速度当然是不够看的。<a href=https://www.intel.cn/content/www/cn/zh/products/sku/134917/intel-ssd-d3s4610-series-960gb-2-5in-sata-6gbs-3d2-tlc/specifications.html>Intel D3-S4610</a>、<a href=https://www.intel.cn/content/www/cn/zh/products/sku/134920/intel-ssd-d3s4510-series-480gb-2-5in-sata-6gbs-3d2-tlc/specifications.html>Intel D3-S4510</a> 等企业级 SSD 除了贵没有任何缺点，但闲鱼上全是高强度锻炼清零盘，实在让人买不下手。</p><p>于是目光转向便宜大碗的京东自营 <a href=https://item.jd.com/6130426.html>英睿达 MX500 2TB</a>。</p><p><img loading=lazy src=https://cloud.lvlv.fun:10000/public/post/MX500-1.jpg#center alt></p><blockquote><p>刚好有活动单价 1199 拿下，5年质保。英睿达京东自营算是全球指定售后点，出了问题基本上直接换新。</p></blockquote><h3 id=pcie>PCIe<a hidden class=anchor aria-hidden=true href=#pcie>#</a></h3><p>PCIe 插槽的选择是最让人纠结的地方，由于 Gen10 Plus 内部只有一个 PCIe 3.0 X16 单槽/半高插槽，能使用的配件主要有下面几个类型：</p><ol><li>显卡</li><li>网卡</li><li>SAS卡</li><li>PCIe SSD/PCIe 转 NVMe 转接卡</li></ol><h4 id=显卡>显卡<a hidden class=anchor aria-hidden=true href=#显卡>#</a></h4><p>选择显卡的理由显而易见：可以硬解 Jellyfin/Emby；可以跑 CUDA；可以虚拟化环境中直通到 Windows 打游戏。</p><p>功耗是不得不考虑的问题，PCIe X16 可提供功耗为 70W，高负载模式下对 Gen10 Plus 的供电来说是不小的挑战。</p><p>本人为了硬解视频先后尝试了 Radeon RX550/GeForce GTX 1650，总的来说 ESXi 环境中A卡的兼容性会好一些，但在特定的应用中转换效率较低；N卡(指1650这样的非专业卡)在 ESXi7.0 中的表现极差，费劲直通到 Windows 却做不到持久化，虚拟机重启就会失效，说到底还是 ESXi 对消费级显卡的不兼容，但在纯 docker 环境中N卡的视频解码表现远比A卡要强。</p><p><img loading=lazy src=https://cloud.lvlv.fun:10000/public/post/GTX-1650-1.jpg#center alt>
<img loading=lazy src=https://cloud.lvlv.fun:10000/public/post/GTX-1650-2.jpg#center alt></p><blockquote><p>上图为盈通 GeForce GTX1650 4GB DDR6，目前 (2022.1) 不用外接电源单槽半高最强显卡，HTPC 最优选择，支持各种视频解码。145mm 全长/纯铜散热片，做工扎实，丽台同款价格 2699，除了 logo 其他完全一样。</p></blockquote><h4 id=网卡>网卡<a hidden class=anchor aria-hidden=true href=#网卡>#</a></h4><p>由于 2.5G/5G 都可以通过 USB3.0 的方式转换，这里推荐 <a href=https://item.jd.com/50579417270.html>威联通（QNAP）5G转换器</a>，在 Linux 下也有很好的兼容性。</p><p>10G(万兆) 分为 电口(RJ45) 和 光口(SFP+)，Gen10 Plus 的 PCIe 区域是没有风道的，从功耗和散热来说，光口更值得推荐。如果有主做 NAS 需求的话，推荐 <a href=https://ark.intel.com/content/www/cn/zh/ark/products/83965/intel-ethernet-converged-network-adapter-x710da4.html>Intel X710-DA4</a>，但记得同时购入光转电模块。</p><p>25G 及以上不在本文讨论范围内。</p><h4 id=sas卡>SAS卡<a hidden class=anchor aria-hidden=true href=#sas卡>#</a></h4><p>除非有非常强烈的硬 RAID 需求，否则不推荐 SAS卡占用唯一的 PCIe 插槽这样的宝贵资源。</p><h4 id=pcie-ssdpcie-转-nvme-转接卡>PCIe SSD/PCIe 转 NVMe 转接卡<a hidden class=anchor aria-hidden=true href=#pcie-ssdpcie-转-nvme-转接卡>#</a></h4><p>PCIe SSD 可以选择 <a href=https://ark.intel.com/content/www/cn/zh/ark/products/88731/intel-ssd-dc-p3608-series-1-6tb-12-height-pcie-3-0-x8-20nm-mlc.html>Intel DC P3608</a> 或 <a href=https://www.intel.com.tw/content/www/tw/zh/products/sku/147528/intel-optane-ssd-905p-series-480gb-2-5in-pcie-x4-3d-xpoint/specifications.html>Intel 傲腾 SSD 905P</a>，但这类企业级 PCIe 太贵了，比较常用的做法是 PCIe 转 NVMe 转接卡类似 <a href=https://item.jd.com/16188486153.html>佳翼冷雨燕NVMe转接卡</a> 这类经济实惠的方案。</p><p>需要注意的是，如果想要 PCIe 转接多条 m.2 NVMe 的话，需要购买自带主控芯片的拆分卡，我的选择是 <a href=https://item.jd.com/39900583730.html>佳翼 NVMe阵列卡 4x4 SSD PCIE转M.2转接卡</a>。</p><p><img loading=lazy src=https://cloud.lvlv.fun:10000/public/post/JY-PCIE-X4-1.jpg#center alt>
<img loading=lazy src=https://cloud.lvlv.fun:10000/public/post/JY-PCIE-X4-2.jpg#center alt>
<img loading=lazy src=https://cloud.lvlv.fun:10000/public/post/JY-PCIE-X4-3.jpg#center alt></p><blockquote><p>自带 ASM2824 主控支持拆分，不挑主板，带涡轮风扇。热量主要来自 SSD 的芯片和主控，加上 PCIe 区域通风不佳，散热只能说马马虎虎，不是这张卡的问题。</p></blockquote><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>smartctl -a /dev/nvme0n1 <span class=p>|</span>grep Temperature
</span></span><span class=line><span class=cl>Temperature:    <span class=m>52</span> Celsius
</span></span><span class=line><span class=cl>smartctl -a /dev/nvme1n1 <span class=p>|</span>grep Temperature
</span></span><span class=line><span class=cl>Temperature:    <span class=m>53</span> Celsius
</span></span></code></pre></div><p><img loading=lazy src=https://cloud.lvlv.fun:10000/public/post/iLO-2.png#center alt></p><blockquote><p>风扇转速 14% 的情况下，最热的 07-BMC 其实是 iLO 芯片，下面的 10-PCI 1 Zone 在低负载下其实温度还行。</p></blockquote><h2 id=网络设备>网络设备<a hidden class=anchor aria-hidden=true href=#网络设备>#</a></h2><h3 id=openwrt>OpenWrt<a hidden class=anchor aria-hidden=true href=#openwrt>#</a></h3><p>比较推荐 J4125 四口 2.5G 软路由，比如 <a href="https://detail.tmall.com/item.htm?id=632829463415">康耐信J4125 I225-V 2.5G</a> 这款，看评测比倍控的方案散热好一些，日后换 2.5G 口的 AP 也比较合适。</p><p>有树莓派的话也可以用树莓派，做个类似这样的方案：</p><p><img loading=lazy src=https://cloud.lvlv.fun:10000/public/post/Pi4B-1.jpg#center alt>
<img loading=lazy src=https://cloud.lvlv.fun:10000/public/post/Pi4B-2.jpg#center alt>
<img loading=lazy src=https://cloud.lvlv.fun:10000/public/post/Pi4B-3.jpg#center alt></p><blockquote><p>树莓派4B + 5口千兆交换机 + USB千兆网卡，小巧又精致。</p></blockquote><p>由于老家是老房子，装修的时候还是百兆网线，手头一个 斐讯N1 就够用了。</p><p>固件选择 <a href=https://github.com/kiddin9/OpenWrt_x86-r2s-r4s-N1>kiddin9</a> 或者 <a href=https://github.com/gd0772/AutoBuild-OpenWrt/releases/tag/AutoUpdate>gd0772</a>。</p><h3 id=wi-fi-mesh>Wi-Fi Mesh<a hidden class=anchor aria-hidden=true href=#wi-fi-mesh>#</a></h3><p>目前是 红米AX6S + 小米AX1800 组 Mesh，对 Wi-Fi 速率需求没那么高，信号覆盖范围广就可以。</p><h2 id=其他>其他<a hidden class=anchor aria-hidden=true href=#其他>#</a></h2><h3 id=ups-不间断电源>UPS 不间断电源<a hidden class=anchor aria-hidden=true href=#ups-不间断电源>#</a></h3><p>UPS 选择的是 <a href=https://item.jd.com/60694084041.html>APC BK650M2-CH</a>，390W 带 服务器 + 路由器 + 交换机足够用了。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl><span class=c1># apt安装守护进程</span>
</span></span><span class=line><span class=cl>sudo apt install -y apcupsd
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 修改配置文件后保存</span>
</span></span><span class=line><span class=cl>sudo vim /etc/apcupsd/apcupsd.conf
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>UPSNAME APC-BK650M2 <span class=c1># 随意修改</span>
</span></span><span class=line><span class=cl>UPSCABLE usb
</span></span><span class=line><span class=cl>UPSTYPE usb
</span></span><span class=line><span class=cl>DEVICE <span class=c1># 留空</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 重启服务</span>
</span></span><span class=line><span class=cl>systemctl restart apcupsd.service
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 查看运行情况</span>
</span></span><span class=line><span class=cl>apcaccess
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>APC      : 001,036,0873
</span></span><span class=line><span class=cl>DATE     : 2022-05-12 15:09:50 +0800
</span></span><span class=line><span class=cl>HOSTNAME : lvlv-Gen10Plus
</span></span><span class=line><span class=cl>VERSION  : 3.14.14 <span class=o>(</span><span class=m>31</span> May 2016<span class=o>)</span> debian
</span></span><span class=line><span class=cl>UPSNAME  : APC-BK650M2
</span></span><span class=line><span class=cl>CABLE    : USB Cable
</span></span><span class=line><span class=cl>DRIVER   : USB UPS Driver
</span></span><span class=line><span class=cl>UPSMODE  : Stand Alone
</span></span><span class=line><span class=cl>STARTTIME: 2022-05-07 09:48:38 +0800
</span></span><span class=line><span class=cl>MODEL    : Back-UPS BK650M2-CH
</span></span><span class=line><span class=cl>STATUS   : ONLINE
</span></span><span class=line><span class=cl>LINEV    : 235.0 Volts
</span></span><span class=line><span class=cl>LOADPCT  : 13.0 Percent
</span></span><span class=line><span class=cl>BCHARGE  : 100.0 Percent
</span></span><span class=line><span class=cl>TIMELEFT : 29.9 Minutes
</span></span><span class=line><span class=cl>MBATTCHG : <span class=m>5</span> Percent
</span></span><span class=line><span class=cl>MINTIMEL : <span class=m>3</span> Minutes
</span></span><span class=line><span class=cl>MAXTIME  : <span class=m>0</span> Seconds
</span></span><span class=line><span class=cl>SENSE    : Low
</span></span><span class=line><span class=cl>LOTRANS  : 160.0 Volts
</span></span><span class=line><span class=cl>HITRANS  : 278.0 Volts
</span></span><span class=line><span class=cl>ALARMDEL : <span class=m>30</span> Seconds
</span></span><span class=line><span class=cl>BATTV    : 13.5 Volts
</span></span><span class=line><span class=cl>LASTXFER : No transfers since turnon
</span></span><span class=line><span class=cl>NUMXFERS : <span class=m>0</span>
</span></span><span class=line><span class=cl>TONBATT  : <span class=m>0</span> Seconds
</span></span><span class=line><span class=cl>CUMONBATT: <span class=m>0</span> Seconds
</span></span><span class=line><span class=cl>XOFFBATT : N/A
</span></span><span class=line><span class=cl>SELFTEST : NG
</span></span><span class=line><span class=cl>STATFLAG : 0x05000008
</span></span><span class=line><span class=cl>SERIALNO : 9B2131A03464
</span></span><span class=line><span class=cl>BATTDATE : 2001-01-01
</span></span><span class=line><span class=cl>NOMINV   : <span class=m>220</span> Volts
</span></span><span class=line><span class=cl>NOMBATTV : 12.0 Volts
</span></span><span class=line><span class=cl>NOMPOWER : <span class=m>390</span> Watts
</span></span><span class=line><span class=cl>FIRMWARE : 294803G -292804G
</span></span><span class=line><span class=cl>END APC  : 2022-05-12 15:10:03 +0800
</span></span></code></pre></div></div><footer class=post-footer><ul class=post-tags><li><a href=https://lvlv.fun/tags/homelab/>HomeLab</a></li><li><a href=https://lvlv.fun/tags/gen10-plus/>Gen10 Plus</a></li></ul><nav class=paginav><a class=prev href=https://lvlv.fun/posts/2022-05-21/><span class=title>« Prev</span><br><span>JavaScript 批量删除 Bilibili 动态</span></a>
<a class=next href=https://lvlv.fun/posts/2019-10-29/><span class=title>Next »</span><br><span>MySQL/innoDB 内部实现</span></a></nav></footer><link href=https://artalk.lvlv.fun:10000/dist/Artalk.css rel=stylesheet><script src=https://artalk.lvlv.fun:10000/dist/Artalk.js></script><div id=Comments></div><script>let isLightMode=function(){return localStorage.getItem("pref-theme")!=="dark"},c={el:"#Comments",pageKey:"",pageTitle:"",server:"https://artalk.lvlv.fun:10000",site:"Lv’s Playground",darkMode:!isLightMode(),avatarURLBuilder:e=>e.user_id===1?window.location.origin+"/avatar.png":"https://source.boringavatars.com/beam/40/"+e.email_encrypted+"?colors=2a363b,f77c3e,faba66,fce185,a2cca5"},artTalk=Artalk.init(c),logoSwitches=document.getElementById("theme-toggle"),getElementComments=function(){return document.getElementById("Comments")},getElementsAtkMainEditor=function(){return document.getElementsByClassName("atk-main-editor")},getElementsAtkCommentWrap=function(){return document.getElementsByClassName("atk-comment-wrap")},getElementsAtkUAWrap=function(){return document.getElementsByClassName("atk-ua-wrap")},initCommonMode=function(){let n=getElementComments();n.style.margin="0.5em 0",n.style.padding="1em 1em",n.style.borderRadius="0.5em";let e=getElementsAtkCommentWrap();for(let t=0;t<e.length;t++)e[t].style.fontSize="14px",e[t].style.margin="0.8em 0",e[t].style.borderRadius="0.5em";let t=getElementsAtkUAWrap();for(let e=0;e<t.length;e++)t[e].style.fontSize="8px",t[e].style.fontStyle="italic",t[e].style.margin="4px"},initDarkMode=function(){let n=getElementComments();n.style.backgroundColor="#111";let e=getElementsAtkCommentWrap();for(let t=0;t<e.length;t++)e[t].style.backgroundColor="#1E2224";let t=getElementsAtkMainEditor();t.length>0&&t[0].setAttribute("style","--at-color-bg: #1E2224")},initLightMode=function(){let n=getElementComments();n.style.backgroundColor="rgb(152, 195, 121, 0.6)";let e=getElementsAtkCommentWrap();for(let t=0;t<e.length;t++)e[t].style.backgroundColor="#F8F7F2";let t=getElementsAtkMainEditor();t.length>0&&t[0].setAttribute("style","--at-color-bg: #F8F7F2")};artTalk.on("list-loaded",function(){initCommonMode(),isLightMode()?initLightMode():initDarkMode()}),logoSwitches.addEventListener("click",function(){isLightMode()?(artTalk.setDarkMode(!0),initDarkMode()):(artTalk.setDarkMode(!1),initLightMode())})</script></article></main><footer class=footer><span>&copy; 2023 <a href=https://lvlv.fun>Lv's Playground</a></span>
<span>|</span>
<span><a href=https://beian.miit.gov.cn/>皖ICP备2022006072号-1</a></span>
<span>|</span>
<span id=busuanzi_container_site_pv><span id=busuanzi_value_site_pv></span></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="copy";function s(){t.innerHTML="copied!",setTimeout(()=>{t.innerHTML="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>